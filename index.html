<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pahul's Room</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            overflow: hidden;
            color: white;
        }
        
        #scene-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            cursor: grab;
        }
        
        #scene-container:active {
            cursor: grabbing;
        }
        
        #scene-container.clickable-cursor {
            cursor: pointer !important;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #ui-overlay {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 5;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        
        #ui-overlay h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #fff;
        }
        
        #ui-overlay p {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        #controls-panel {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 5;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .control-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        #error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 15;
            display: none;
        }
        
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            display: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        @media (max-width: 768px) {
            #ui-overlay {
                top: 15px;
                left: 15px;
                right: 15px;
                max-width: none;
                padding: 15px;
            }
            
            #ui-overlay h1 {
                font-size: 20px;
            }
            
            #controls-panel {
                bottom: 15px;
                right: 15px;
                left: 15px;
                text-align: center;
            }
            
            .control-button {
                display: inline-block;
                margin: 2px;
            }
        }
        
        .fade-in {
            opacity: 0;
            animation: fadeIn 1s ease-in forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="scene-container">
        <div id="loading">
            <div class="spinner"></div>
            <div id="loading-text">Loading 3D Model...</div>
            <div id="loading-progress">0%</div>
        </div>
        
        <div id="ui-overlay" class="fade-in">
            <h1>welcome to my study!</h1>
            <p>üñ±Ô∏è Drag to rotate</p>
            <p>üîç Scroll to zoom</p>
            <p>üíª Hold Shift and Pan to move around</p>
            <p>üì± Touch and pinch on mobile</p>
            <p>üëÜ Click objects to interact!</p>
            <p style="color: #ffeb3b;">üéπ Click piano keys for real piano sounds!</p>
        </div>
        
        <div id="controls-panel" class="fade-in">
            <button class="control-button" onclick="resetCamera()">Reset View</button>
            <button class="control-button" onclick="toggleWireframe()">Wireframe</button>
            <button class="control-button" onclick="highlightClickables()">Show Clickables</button>
        </div>
        
        <div id="tooltip"></div>
        
        <div id="error-message">
            <h3>Error Loading 3D Model</h3>
            <p>Please check that maxpolyroom.glb is in the same folder as this HTML file.</p>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.130.1/build/three.module.js';
        import * as Tone from 'https://cdn.skypack.dev/tone@14.8.49';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.130.1/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.130.1/examples/jsm/loaders/GLTFLoader.js';
        import { DRACOLoader } from 'https://cdn.skypack.dev/three@0.130.1/examples/jsm/loaders/DRACOLoader.js';
        
        let scene, camera, renderer, controls;
        let loadedModel = null;
        let isWireframe = false;
        
        // Audio setup
        let pianoSampler = null;
        let audioInitialized = false;
        
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let allObjects = []; // Simple array of all objects in the scene
        let interactableObjects = []; // Objects that can be clicked
        let hoveredObject = null;
        let highlightedObjects = [];
        let highlightMaterial = null;
        let originalMaterials = new Map();
        
        const loadingElement = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const loadingProgress = document.getElementById('loading-progress');
        const errorMessage = document.getElementById('error-message');
        const tooltip = document.getElementById('tooltip');
        const sceneContainer = document.getElementById('scene-container');
        
        // Complete 88-key piano note mapping (A0 to C8)
        const PIANO_NOTES = [
            'A0', 'A#0', 'B0',
            'C1', 'C#1', 'D1', 'D#1', 'E1', 'F1', 'F#1', 'G1', 'G#1', 'A1', 'A#1', 'B1',
            'C2', 'C#2', 'D2', 'D#2', 'E2', 'F2', 'F#2', 'G2', 'G#2', 'A2', 'A#2', 'B2',
            'C3', 'C#3', 'D3', 'D#3', 'E3', 'F3', 'F#3', 'G3', 'G#3', 'A3', 'A#3', 'B3',
            'C4', 'C#4', 'D4', 'D#4', 'E4', 'F4', 'F#4', 'G4', 'G#4', 'A4', 'A#4', 'B4',
            'C5', 'C#5', 'D5', 'D#5', 'E5', 'F5', 'F#5', 'G5', 'G#5', 'A5', 'A#5', 'B5',
            'C6', 'C#6', 'D6', 'D#6', 'E6', 'F6', 'F#6', 'G6', 'G#6', 'A6', 'A#6', 'B6',
            'C7', 'C#7', 'D7', 'D#7', 'E7', 'F7', 'F#7', 'G7', 'G#7', 'A7', 'A#7', 'B7',
            'C8'
        ];
        
        // Key name patterns to match with your Blender model
        const KEY_NAME_PATTERNS = {
            // White keys
            'piano_a': (octave) => `A${octave}`,
            'piano_b': (octave) => `B${octave}`,
            'piano_c': (octave) => `C${octave}`,
            'piano_d': (octave) => `D${octave}`,
            'piano_e': (octave) => `E${octave}`,
            'piano_f': (octave) => `F${octave}`,
            'piano_g': (octave) => `G${octave}`,
            
            // Sharp keys (black keys)
            'piano_sharp_a': (octave) => `A#${octave}`,
            'piano_sharp_c': (octave) => `C#${octave}`,
            'piano_sharp_d': (octave) => `D#${octave}`,
            'piano_sharp_f': (octave) => `F#${octave}`,
            'piano_sharp_g': (octave) => `G#${octave}`,
            
            // Alternative naming patterns
            'piano_as': (octave) => `A#${octave}`,
            'piano_cs': (octave) => `C#${octave}`,
            'piano_ds': (octave) => `D#${octave}`,
            'piano_fs': (octave) => `F#${octave}`,
            'piano_gs': (octave) => `G#${octave}`,
        };
        
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x2c3e50);
            
            camera = new THREE.PerspectiveCamera(
                50,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            
            camera.position.set(2, 2, 2);
            camera.lookAt(0, 0, 0);
            
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true,
                powerPreference: "high-performance"
            });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            
            sceneContainer.appendChild(renderer.domElement);
            
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enableZoom = true;
            controls.enablePan = true;
            controls.minDistance = 3;
            controls.maxDistance = 50;
            controls.maxPolarAngle = Math.PI * 0.75;
            
            highlightMaterial = new THREE.MeshStandardMaterial({
                color: 0x00ff00,
                emissive: 0x004400,
                transparent: true,
                opacity: 0.8
            });
            
            setupLighting();
            setupInteraction();
            setupAudio();
            loadModel();
        }
        
        function setupInteraction() {
            sceneContainer.addEventListener('mousemove', onMouseMove, false);
            sceneContainer.addEventListener('click', onMouseClick, false);
            sceneContainer.addEventListener('touchstart', onTouchStart, false);
            sceneContainer.addEventListener('touchend', onTouchEnd, false);
        }
        
        async function setupAudio() {
            try {
                // Create a high-quality piano sampler
                pianoSampler = new Tone.Sampler({
                    urls: {
                        A0: "A0.mp3",
                        C1: "C1.mp3",
                        "D#1": "Ds1.mp3",
                        "F#1": "Fs1.mp3",
                        A1: "A1.mp3",
                        C2: "C2.mp3",
                        "D#2": "Ds2.mp3",
                        "F#2": "Fs2.mp3",
                        A2: "A2.mp3",
                        C3: "C3.mp3",
                        "D#3": "Ds3.mp3",
                        "F#3": "Fs3.mp3",
                        A3: "A3.mp3",
                        C4: "C4.mp3",
                        "D#4": "Ds4.mp3",
                        "F#4": "Fs4.mp3",
                        A4: "A4.mp3",
                        C5: "C5.mp3",
                        "D#5": "Ds5.mp3",
                        "F#5": "Fs5.mp3",
                        A5: "A5.mp3",
                        C6: "C6.mp3",
                        "D#6": "Ds6.mp3",
                        "F#6": "Fs6.mp3",
                        A6: "A6.mp3",
                        C7: "C7.mp3",
                        "D#7": "Ds7.mp3",
                        "F#7": "Fs7.mp3",
                        A7: "A7.mp3",
                        C8: "C8.mp3"
                    },
                    baseUrl: "https://tonejs.github.io/audio/salamander/",
                    onload: () => {
                        console.log('Piano samples loaded successfully');
                    },
                    onerror: (error) => {
                        console.error('Error loading piano samples:', error);
                        setupFallbackSynth();
                    }
                }).toDestination();
                
                // Add subtle reverb and compression for realistic sound
                const reverb = new Tone.Reverb({
                    decay: 1.5,
                    preDelay: 0.01,
                    wet: 0.15
                }).toDestination();
                
                const compressor = new Tone.Compressor({
                    threshold: -12,
                    ratio: 3,
                    attack: 0.003,
                    release: 0.01
                }).toDestination();
                
                pianoSampler.connect(reverb);
                pianoSampler.connect(compressor);
                
                console.log('Piano sampler initialized with', PIANO_NOTES.length, 'notes');
            } catch (error) {
                console.error('Error setting up audio:', error);
                setupFallbackSynth();
            }
        }
        
        function setupFallbackSynth() {
            console.log('Setting up fallback synthesizer...');
            try {
                pianoSampler = new Tone.PolySynth({
                    voice: Tone.Synth,
                    options: {
                        oscillator: {
                            type: "fmtriangle",
                            harmonicity: 0.5,
                            modulationIndex: 2
                        },
                        envelope: {
                            attack: 0.01,
                            decay: 0.2,
                            sustain: 0.1,
                            release: 1.5
                        },
                        filterEnvelope: {
                            attack: 0.01,
                            decay: 0.1,
                            sustain: 0.5,
                            release: 0.5,
                            baseFrequency: 200,
                            octaves: 2
                        }
                    }
                }).toDestination();
                console.log('Fallback synth ready');
            } catch (error) {
                console.error('Fallback synth failed:', error);
            }
        }
        
        async function initializeAudioContext() {
            if (!audioInitialized) {
                try {
                    await Tone.start();
                    audioInitialized = true;
                    console.log('Audio context started');
                } catch (error) {
                    console.error('Error starting audio context:', error);
                }
            }
        }
        
        function onMouseMove(event) {
            event.preventDefault();
            
            const rect = sceneContainer.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactableObjects, true);
            
            if (intersects.length > 0) {
                const intersectedObject = intersects[0].object;
                
                if (hoveredObject !== intersectedObject) {
                    clearHighlights();
                    hoveredObject = intersectedObject;
                    highlightRelatedObjects(intersectedObject);
                    sceneContainer.classList.add('clickable-cursor');
                    showTooltip(event, getZoneName(intersectedObject));
                }
                
                updateTooltip(event);
            } else {
                if (hoveredObject) {
                    clearHighlights();
                    hoveredObject = null;
                    sceneContainer.classList.remove('clickable-cursor');
                    hideTooltip();
                }
            }
        }
        
        function onMouseClick(event) {
            event.preventDefault();
            initializeAudioContext();
            
            const rect = sceneContainer.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactableObjects, true);
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                handleObjectClick(clickedObject);
            }
        }
        
        function onTouchStart(event) {
            if (event.touches.length === 1) {
                const touch = event.touches[0];
                const rect = sceneContainer.getBoundingClientRect();
                mouse.x = ((touch.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((touch.clientY - rect.top) / rect.height) * 2 + 1;
            }
        }
        
        function onTouchEnd(event) {
            initializeAudioContext();
            
            if (event.changedTouches.length === 1) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(interactableObjects, true);
                
                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    handleObjectClick(clickedObject);
                }
            }
        }
        
        function highlightRelatedObjects(clickedObject) {
            const objectName = clickedObject.name.toLowerCase();
            let objectsToHighlight = [];
            
            if (objectName.includes('laptop_hitbox')) {
                objectsToHighlight = allObjects.filter(obj => 
                    obj.name.toLowerCase().includes('macbook') && 
                    !obj.name.toLowerCase().includes('hitbox')
                );
            } else if (objectName.includes('badminton_hitbox')) {
                objectsToHighlight = allObjects.filter(obj => 
                    obj.name.toLowerCase().includes('racquet') && 
                    !obj.name.toLowerCase().includes('hitbox')
                );
            } else if (objectName.includes('calendar_hitbox')) {
                objectsToHighlight = allObjects.filter(obj => 
                    obj.name.toLowerCase().includes('calendar') && 
                    !obj.name.toLowerCase().includes('hitbox')
                );
            } else if (objectName.includes('certificate_hitbox')) {
                objectsToHighlight = [clickedObject];
            } else if (objectName.includes('piano_zone') && !objectName.includes('piano_zone_')) {
                objectsToHighlight = allObjects.filter(obj => 
                    obj.name.toLowerCase().includes('piano') && 
                    !obj.name.toLowerCase().includes('zone') &&
                    !obj.name.toLowerCase().includes('hitbox')
                );
            } else if (objectName.includes('piano') && !objectName.includes('zone')) {
                objectsToHighlight = [clickedObject];
            }
            
            objectsToHighlight.forEach(obj => {
                if (!originalMaterials.has(obj)) {
                    originalMaterials.set(obj, obj.material);
                }
                obj.material = highlightMaterial.clone();
                highlightedObjects.push(obj);
            });
            
            console.log(`Highlighting ${objectsToHighlight.length} objects for "${clickedObject.name}"`);
        }
        
        function handleObjectClick(clickedObject) {
            const objectName = clickedObject.name.toLowerCase();
            const zoneName = getZoneName(clickedObject);
            console.log('Clicked on:', zoneName, '(' + clickedObject.name + ')');
            
            if (zoneName.includes('Piano Key')) {
                handlePianoKeyClick(clickedObject);
            } else if (objectName.includes('laptop_hitbox')) {
                handleLaptopClick();
            } else if (objectName.includes('badminton_hitbox')) {
                handleBadmintonClick();
            } else if (objectName.includes('calendar_hitbox')) {
                handleCalendarClick();
            } else if (objectName.includes('certificate_hitbox')) {
                handleCertificateClick();
            } else if (objectName.includes('piano_zone')) {
                handlePianoClick();
            }
        }
        
        async function handlePianoKeyClick(key) {
            const keyName = key.name;
            console.log('Piano key clicked:', keyName);
            
            await initializeAudioContext();
            
            if (!pianoSampler) {
                console.error('Piano sampler not initialized');
                return;
            }
            
            const note = parseKeyName(keyName);
            if (note && PIANO_NOTES.includes(note)) {
                // Play the note with dynamic velocity
                const velocity = 0.7 + Math.random() * 0.3; // Random velocity for natural sound
                pianoSampler.triggerAttackRelease(note, '0.5', undefined, velocity);
                console.log(`Playing note: ${note} (velocity: ${velocity.toFixed(2)})`);
                
                // Visual feedback
                const isSharp = note.includes('#');
                const originalMaterial = key.material;
                
                if (!originalMaterials.has(key)) {
                    originalMaterials.set(key, originalMaterial);
                }
                
                // Apply pressed visual
                key.material = new THREE.MeshStandardMaterial({
                    color: isSharp ? 0x222222 : 0xcccccc,
                    emissive: isSharp ? 0x220000 : 0x002200,
                });
                
                // Return to normal after delay
                setTimeout(() => {
                    key.material = originalMaterials.get(key);
                }, 200);
            } else {
                console.warn('Could not parse or find note from key name:', keyName);
                console.log('Available notes:', PIANO_NOTES.slice(0, 10), '...');
            }
        }
        
        function parseKeyName(keyName) {
            const name = keyName.toLowerCase();
            console.log('Parsing key name:', name);
            
            // Try all patterns
            for (const [pattern, noteFunction] of Object.entries(KEY_NAME_PATTERNS)) {
                if (name.includes(pattern)) {
                    // Extract octave number
                    const octaveMatch = name.match(/(\d+)/);
                    if (octaveMatch) {
                        let octave = parseInt(octaveMatch[1]);
                        
                        // Adjust octave for A, A#, and B keys (they should be 1 octave lower)
                        // This is because piano octaves change at C, not A
                        if (pattern.includes('piano_a') || pattern.includes('piano_b') || pattern.includes('piano_sharp_a')) {
                            octave = octave - 1;
                            console.log(`Adjusting octave for A/A#/B key: ${octave + 1} -> ${octave}`);
                        }
                        
                        const note = noteFunction(octave.toString());
                        
                        // Validate note exists in our range
                        if (PIANO_NOTES.includes(note)) {
                            console.log(`Parsed "${keyName}" -> "${note}"`);
                            return note;
                        }
                    }
                }
            }
            
            // Fallback: try direct pattern matching with octave adjustment
            const directMatch = name.match(/piano_([a-g])(#|sharp)?(\d+)/);
            if (directMatch) {
                const noteName = directMatch[1].toUpperCase();
                const isSharp = directMatch[2] !== undefined;
                let octave = parseInt(directMatch[3]);
                
                // Adjust octave for A, A#, and B keys
                if (noteName === 'A' || noteName === 'B' || noteName === 'A#') {
                    octave = octave - 1;
                    console.log(`Adjusting octave for ${noteName}${isSharp ? '#' : ''} key: ${parseInt(directMatch[3])} -> ${octave}`);
                }
                
                const fullNote = isSharp ? `${noteName}#${octave}` : `${noteName}${octave}`;
                
                if (PIANO_NOTES.includes(fullNote)) {
                    console.log(`Direct parsed "${keyName}" -> "${fullNote}"`);
                    return fullNote;
                }
            }
            
            console.warn('Could not parse key name:', keyName);
            return null;
        }
        
        function getZoneName(object) {
            const name = object.name.toLowerCase();
            if (name.includes('laptop_hitbox')) return 'Laptop';
            if (name.includes('badminton_hitbox')) return 'Badminton';
            if (name.includes('calendar_hitbox')) return 'Calendar';
            if (name.includes('certificate_hitbox')) return 'Certificate';
            if (name.includes('piano_zone')) return 'Piano';
            if (name.includes('piano') && !name.includes('zone')) {
                const note = parseKeyName(object.name);
                if (note) {
                    return `Piano Key (${note})`;
                }
                if (name.includes('sharp')) return 'Piano Key (Sharp)';
                return 'Piano Key';
            }
            return 'Interactive Object';
        }
        
        function clearHighlights() {
            highlightedObjects.forEach(obj => {
                if (originalMaterials.has(obj)) {
                    obj.material = originalMaterials.get(obj);
                }
            });
            highlightedObjects = [];
        }
        
        function showTooltip(event, zoneName = 'item') {
            tooltip.textContent = `Click to interact with ${zoneName}`;
            tooltip.style.display = 'block';
            tooltip.style.opacity = '1';
            updateTooltip(event);
        }
        
        function updateTooltip(event) {
            const rect = sceneContainer.getBoundingClientRect();
            tooltip.style.left = (event.clientX - rect.left + 10) + 'px';
            tooltip.style.top = (event.clientY - rect.top - 30) + 'px';
        }
        
        function hideTooltip() {
            tooltip.style.opacity = '0';
            setTimeout(() => {
                tooltip.style.display = 'none';
            }, 300);
        }
        
        // Interaction handlers
        function handleLaptopClick() {
            console.log('Laptop clicked - opening portfolio website...');
            showModal('Laptop', `
                <h3>üíª My Development Setup</h3>
                <p>This is my trusty MacBook where I code my projects!</p>
                <ul>
                    <li>React & Next.js Applications</li>
                    <li>Python Data Science Projects</li>
                    <li>3D Web Experiences with Three.js</li>
                    <li>Mobile Apps with React Native</li>
                </ul>
                <button onclick="window.open('https://github.com/pafool', '_blank')">
                    View My GitHub
                </button>
            `);
        }
        
        function handleBadmintonClick() {
            console.log('Badminton gear clicked - showing sports achievements...');
            showModal('Badminton', `
                <h3>üè∏ Sports & Recreation</h3>
                <p>Badminton is one of my favorite sports!</p>
                <ul>
                    <li>University Badminton Team Member</li>
                    <li>Local Tournament Participant</li>
                    <li>Doubles Specialist</li>
                    <li>Weekend League Player</li>
                </ul>
                <p>Sports teach discipline, teamwork, and perseverance - values I bring to my work.</p>
            `);
        }
        
        function handleCalendarClick() {
            console.log('Calendar clicked - showing schedule...');
            showModal('Calendar', `
                <h3>üìÖ My Schedule</h3>
                <p>Here's what I'm currently working on:</p>
                <div class="schedule">
                    <div class="schedule-item">
                        <strong>This Week:</strong> Final year project development
                    </div>
                    <div class="schedule-item">
                        <strong>Upcoming:</strong> Job interviews and portfolio reviews
                    </div>
                    <div class="schedule-item">
                        <strong>Goals:</strong> Launch personal website and mobile app
                    </div>
                </div>
                <p>Always planning ahead and staying organized!</p>
            `);
        }
        
        function handleCertificateClick() {
            console.log('Certificate clicked - showing credentials...');
            showModal('Certificates', `
                <h3>üèÜ Certifications & Achievements</h3>
                <p>Here are some of my achievements/awards:</p>
                <ul>
                    <li>Coming soon!</li>
                </ul>
            `);
        }
        
        function handlePianoClick() {
            console.log('Piano clicked - showing music projects...');
            showModal('Piano', `
                <h3>üéπ Music & Creativity</h3>
                <p>Music is my creative outlet and source of inspiration!</p>
                <ul>
                    <li>Self-taught pianist (5+ years)</li>
                    <li>Compose original pieces</li>
                    <li>Record and produce music</li>
                    <li>Perform at local events</li>
                </ul>
                <p>Music enhances my creativity and problem-solving skills in programming.</p>
                <p><strong>üéπ All 88 piano keys are now functional with real note sounds!</strong></p>
                <button onclick="playPianoDemo()">üéµ Play Demo Scale</button>
            `);
        }
        
        // Piano demo function
        window.playPianoDemo = async function() {
            await initializeAudioContext();
            if (!pianoSampler) return;
            
            const demoNotes = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'];
            let delay = 0;
            
            demoNotes.forEach((note, index) => {
                setTimeout(() => {
                    pianoSampler.triggerAttackRelease(note, '0.5');
                }, delay);
                delay += 300;
            });
        };
        
        function showModal(title, content) {
            const existingModal = document.getElementById('interaction-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modalHTML = `
                <div id="interaction-modal" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>${title}</h2>
                            <button class="modal-close" onclick="closeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            if (!document.getElementById('modal-styles')) {
                const styles = `
                    <style id="modal-styles">
                        .modal-overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.8);
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            z-index: 1000;
                            backdrop-filter: blur(5px);
                        }
                        
                        .modal-content {
                            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                            border-radius: 15px;
                            max-width: 500px;
                            width: 90%;
                            max-height: 80vh;
                            overflow-y: auto;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                            color: white;
                        }
                        
                        .modal-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 20px;
                            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                        }
                        
                        .modal-header h2 {
                            margin: 0;
                            font-size: 24px;
                        }
                        
                        .modal-close {
                            background: none;
                            border: none;
                            color: white;
                            font-size: 30px;
                            cursor: pointer;
                            width: 40px;
                            height: 40px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: background 0.3s ease;
                        }
                        
                        .modal-close:hover {
                            background: rgba(255, 255, 255, 0.2);
                        }
                        
                        .modal-body {
                            padding: 20px;
                        }
                        
                        .modal-body ul {
                            padding-left: 20px;
                            margin: 15px 0;
                        }
                        
                        .modal-body li {
                            margin: 8px 0;
                        }
                        
                        .modal-body button {
                            background: rgba(255, 255, 255, 0.2);
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            color: white;
                            padding: 10px 20px;
                            border-radius: 25px;
                            cursor: pointer;
                            margin: 10px 5px 0 0;
                            transition: all 0.3s ease;
                        }
                        
                        .modal-body button:hover {
                            background: rgba(255, 255, 255, 0.3);
                            transform: translateY(-2px);
                        }
                        
                        .schedule-item {
                            background: rgba(255, 255, 255, 0.1);
                            padding: 10px;
                            margin: 8px 0;
                            border-radius: 8px;
                            border-left: 3px solid #4a90e2;
                        }
                    </style>
                `;
                document.head.insertAdjacentHTML('beforeend', styles);
            }
        }
        
        window.closeModal = function() {
            const modal = document.getElementById('interaction-modal');
            if (modal) {
                modal.remove();
            }
        };
        
        // Event listeners for modal
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });
        
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        function setupLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 3);
            scene.add(ambientLight);
            
            const windowLightA = new THREE.PointLight(0xffffff, 1, 0, 2);
            windowLightA.position.set(-1.92, 0.1, -0.5);
            windowLightA.castShadow = true;
            scene.add(windowLightA);

            windowLightA.shadow.mapSize.width = 512;
            windowLightA.shadow.mapSize.height = 512;
            windowLightA.shadow.bias = -0.00005
            windowLightA.shadow.camera.near = 0.5;
            windowLightA.shadow.camera.far = 500;

            const windowLightB = new THREE.PointLight(0xffffff, 1, 0, 2);
            windowLightB.position.set(-1.92, 0.1, 0.5);
            windowLightB.castShadow = true;
            scene.add(windowLightB);

            windowLightB.shadow.mapSize.width = 512;
            windowLightB.shadow.mapSize.height = 512;
            windowLightB.shadow.bias = -0.00005
            windowLightB.shadow.camera.near = 0.5;
            windowLightB.shadow.camera.far = 500;

            const windowLightC = new THREE.PointLight(0xffffff, 1, 0, 2);
            windowLightC.position.set(-1.92, 0.1, 0.1);
            windowLightC.castShadow = true;
            scene.add(windowLightC);

            windowLightC.shadow.mapSize.width = 512;
            windowLightC.shadow.mapSize.height = 512;
            windowLightC.shadow.bias = -0.00005
            windowLightC.shadow.camera.near = 0.5;
            windowLightC.shadow.camera.far = 500;

            const rectLight = new THREE.RectAreaLight(0xffffff, 50, 2, 1);
            rectLight.position.set(-2.2, 0.1, 0.1);
            rectLight.rotation.y = -Math.PI / 2;
            scene.add(rectLight);

            const fillLight = new THREE.DirectionalLight(0x87CEEB, 0.3);
            fillLight.position.set(-5, 3, -5);
            scene.add(fillLight);
            
            const rimLight = new THREE.DirectionalLight(0xffffff, 0.2);
            rimLight.position.set(0, 5, -10);
            scene.add(rimLight);
        }
        
        function loadModel() {
            const loader = new GLTFLoader();
            
            const dracoLoader = new DRACOLoader();
            dracoLoader.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
            loader.setDRACOLoader(dracoLoader);
            
            loader.load(
                'maxpolyroom.glb',
                
                function (gltf) {
                    loadedModel = gltf.scene;
                    
                    loadedModel.traverse(function (child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            if (child.material) {
                                child.material.envMapIntensity = 0.8;
                                child.material.side = THREE.DoubleSide;
                            }
                            
                            allObjects.push(child);
                            
                            if (child.name) {
                                const objectName = child.name.toLowerCase();
                                
                                if (objectName.includes('hitbox') || 
                                    objectName.includes('certificate') ||
                                    (objectName.includes('piano') && !objectName.includes('zone_'))) {
                                    
                                    interactableObjects.push(child);
                                    
                                    if (objectName.includes('hitbox') || 
                                        (objectName.includes('piano_zone') && !objectName.includes('piano_zone_'))) {
                                        child.visible = false;
                                    }
                                }
                            }
                        }
                    });
                    
                    scene.add(loadedModel);
                    console.log(`Found ${allObjects.length} total objects`);
                    console.log(`Found ${interactableObjects.length} interactable objects`);
                    
                    // Log piano keys found
                    const pianoKeys = interactableObjects.filter(obj => 
                        obj.name.toLowerCase().includes('piano') && !obj.name.toLowerCase().includes('zone')
                    );
                    console.log(`Found ${pianoKeys.length} piano keys:`);
                    pianoKeys.forEach(key => console.log(`- ${key.name}`));
                    
                    hideLoading();
                },
                
                function (progress) {
                    if (progress.lengthComputable) {
                        const percentComplete = (progress.loaded / progress.total * 100);
                        loadingProgress.textContent = Math.round(percentComplete) + '%';
                    }
                },
                
                function (error) {
                    console.error('Error loading model:', error);
                    showError();
                }
            );
        }
        
        function hideLoading() {
            loadingElement.style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('ui-overlay').style.opacity = '1';
                document.getElementById('controls-panel').style.opacity = '1';
            }, 100);
        }
        
        function showError() {
            loadingElement.style.display = 'none';
            errorMessage.style.display = 'block';
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function resetCamera() {
            controls.reset();
            camera.position.set(2, 2, 2);
            camera.lookAt(0, 0, 0);
        }
        
        function toggleWireframe() {
            if (!loadedModel) return;
            
            isWireframe = !isWireframe;
            
            loadedModel.traverse(function (child) {
                if (child.isMesh && child.material) {
                    child.material.wireframe = isWireframe;
                }
            });
        }
        
        function highlightClickables() {
            if (interactableObjects.length === 0) {
                alert('No interactive zones found in the model.');
                return;
            }
            
            console.log('Highlighting all interactive objects...');
            
            interactableObjects.forEach(obj => {
                highlightRelatedObjects(obj);
            });
            
            setTimeout(() => {
                clearHighlights();
            }, 3000);
        }
        
        window.resetCamera = resetCamera;
        window.toggleWireframe = toggleWireframe;
        window.highlightClickables = highlightClickables;
        
        window.addEventListener('resize', onWindowResize, false);
        
        window.addEventListener('orientationchange', function() {
            setTimeout(onWindowResize, 100);
        });
        
        init();
        animate();
    </script>
</body>
</html>